#set($userId = $ctx.identity.sub)

## Get the path first
{
    "version": "2018-05-29",
    "operation": "GetItem",
    "key": {
        "id": $util.dynamodb.toDynamoDBJson($ctx.args.pathId)
    }
}

$util.qr($ctx.stash.put("path", $ctx.result))

## Check if user has access to workspace
{
    "version": "2018-05-29",
    "operation": "Query",
    "index": "UserWorkspaceIndex",
    "query": {
        "expression": "user_id = :userId AND workspace_id = :workspaceId",
        "expressionValues": {
            ":userId": $util.dynamodb.toDynamoDBJson($userId),
            ":workspaceId": $util.dynamodb.toDynamoDBJson($ctx.stash.path.workspace_id)
        }
    }
}
